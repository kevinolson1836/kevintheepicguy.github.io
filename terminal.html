<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Terminal</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
        }
        #terminal {
            width: 80%;
            height: 80%;
            margin: 1.5vh auto;
            padding: 10px;
            border: 3px solid #ccc;
            background-color: #000;
            color: white;
            min-height: 95vh;
            overflow-y: auto;
            cursor: none;
            caret-color: transparent;
            font-size: 20px;
        }

        /* using p tags  to change colors and such */
        p{
            display: inline;
        }

        .grey{
            color: rgb(215, 213, 213);
        }

        .dark-grey{
            color: rgb(12, 128, 128)
        }

        .blue{
            color: rgb(125, 125, 126);
        }
        
        .light-blue{
            color: rgb(167, 199, 231)
        }
        
        .dark-blue{
            color:blue;
        }


        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
        }

        .row {
            display: grid;
            grid-template-rows: repeat(3, 1fr);
        }

        .cell {
            padding: 10px;
            text-align: center;
        }



    </style>
</head>
<body onload="initTerminal()">

<div id="terminal" contenteditable="true"  autocomplete="off" autocapitalize="off" spellcheck="off" autocorrect="off"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
    const terminal = document.getElementById('terminal');
    var count = 0;
    var intervalID = null;
    var timeout = 0;
    var arrowCount = 0;
    var charCount = 0;

    var rawChars = "";
    var output 

    const prompt = `<p class=grey>User</p><p class=dark-grey>@</p><p>kevin-Olson</p><p class="blue">:</p><p class="light-blue">~/Kevin> </p><p> `;
                    // <p class="grey">User</p><p class="dark-grey">@</p><p>kevin-Olson</p><p class="blue">:</p><p class="light-blue">~/Kevin&gt; </p><p> </p>     
    function intervalManager(input) {
        if(input === 1){

            intervalID = setInterval(function () {
                count+=1
                                                    var temp = terminal.innerHTML
                                                    
                                                    if (count%2 == 0){
                                                        temp = temp.replace("_", " ");
                                                    } else {
                                                        temp = temp.replace(" ", "_");
                                                    }

                                                    terminal.innerHTML = temp;  
                                                    // console.log(terminal.innerHTML.replace(prompt, ""));
                                                    // console.log(" ");
                                                    // console.log(" ");
                                                    // console.log(" ");
                                                    // console.log(" ");
                                                    // console.log(" ");
                                                }, 500);
                                                
                                            

                                            }else{
            clearInterval(intervalID);
            
            var temp2 = terminal.innerHTML;
            while (temp2.indexOf(" ") > -1){
                temp2 = temp2.replace(" ", "");
            } 

            while (temp2.indexOf("_") > -1){
                temp2 = temp2.replace("_", "");
            } 
                terminal.innerHTML = temp2;
    }
    }

    function initTerminal(){
        intervalManager(1);
        terminal.innerHTML += prompt;
    }


    function addCharAt(str,index,char) {

        // strip the underline and bold
        if (str.indexOf("<u><strong>") > -1){
            str = str.replace("<u><strong>", "");
            index -= 12;
        } 

        if (str.indexOf("</strong></u>") > -1){
            str = str.replace("</strong></u>", "");
            index -= 12;
        } 



        if (index >= 0 && index < str.length) {

            // Wrap the character at the specified index with <u> tags for underline
                str = str.substring(0, index+1) + "<u><strong>"+ char + "</strong></u>" + str.substring(index + 1);
        }
        return str;
    }


    function processCommand(str){

        if(str.indexOf("ls") > -1){
            return(`
            <div class="grid">
                <div class="row">
                    <div class="cell dark-blue">Education</div>
                    <div class="cell dark-blue">Projects</div>
                </div>
                <div class="row">
                    <div class="cell ">README.TXT</div>
                    <div class="cell dark-blue">get-to-know-me</div>
                    
                </div>
                <div class="row">
                    <div class="cell dark-blue">Work-Experience</div>
                </div>
            </div>
            `);
        }


        if(str.indexOf("help") > -1){
                // cat the readme file
                return("this is somewhat of a Linux like command line interrupter I built. there are a few <i>'commands'</i> such as 'ls' 'cat' 'help (displays this)' and 'cd'\n\n this 'file system' is my resume feel free to go exploring around! ");
        }

        if(str.startsWith("cat")){

            if(str.indexOf("README.txt") > -1){
                // cat the readme file
                return("this is the readme section! fill this bad boy out!");
            }

            if(str.indexOf("instructions.txt") > -1){
                // cat the readme file
                return("this is somewhat of a Linux like command line interrupter I built. there are a few <i>'commands'</i> such as 'ls' 'cat' 'help (displays this)' and 'cd'\n\n\n this 'file system' is my resume feel free to go exploring around! ");
            }

        }

    }


    function underlineCharAtIndex(html, index) {
        if (index >= 0 && index < html.length) {
            // Wrap the character at the specified index with <u> tags for underline
            html = html.substring(0, index) + '<u><strong>' + html.charAt(index) + '</strong></u>' + html.substring(index + 1);
        }
        return html;
    }

    terminal.addEventListener('keypress', function (event) {
        var input = String.fromCharCode(event.keyCode); 
        // if number or letter or quote or double quote was pressed
        if (/[a-zA-Z0-9-_ .'"]/.test(input)) {
                charCount +=1;
                // delay the blinking for smooth looking typing
                clearTimeout(timeout);
                timeout = window.setTimeout( 
                                                function() {
                                                    terminal.innerHTML += "_";
                                                }, 250);

                intervalManager(0) // stop the blinking
                event.preventDefault();
                const input = event.key
                if (arrowCount >= 0){
                    terminal.innerHTML += input;
                } else {
                    terminal.innerHTML = addCharAt(terminal.innerHTML, terminal.innerHTML.length + arrowCount, input)
                }
                intervalManager(1) // start the blinking

                // i have no idea why this needs to be stripped out, there is probably a better way but this works i guess
                terminal.innerHTML = terminal.innerHTML.replace('<div><p class="grey"><br></p></div>', "");
                terminal.innerHTML = terminal.innerHTML.replace('<div><p class="grey"></p></div>', "");

      }

      else if (event.keyCode === 13){ //enter key pressed
        intervalManager(0) // stop the blinking of the underscore
        // i have no idea why this needs to be stripped out, there is probably a better way but this works i guess
        terminal.innerHTML = terminal.innerHTML.replace('<div><p class="grey"><br></p></div>', "");

        // todo: command processing here

        if (terminal.innerHTML.indexOf("<u><strong>") > -1){
            terminal.innerHTML = terminal.innerHTML.replace("<u><strong>", "");
        } 

        if (terminal.innerHTML.indexOf("</strong></u>") > -1){
            terminal.innerHTML = terminal.innerHTML.replace("</strong></u>", "");
        } 

        rawChars = terminal.innerHTML.substring(terminal.innerHTML.length - charCount, terminal.innerHTML.length);

        output = processCommand(rawChars);

        terminal.innerHTML += `<br><br><div style='display=block;'>${output}</div><br>` + prompt.substring(0, prompt.length);

        arrowCount = 0; //reset the counter of left/right arrows
        charCount = 0; // reset the charCount counter

        scrollToBottom();
        intervalManager(1) // start the blinking of the underscore

      }else{

                // i have no idea why this needs to be stripped out, there is probably a better way but this works i guess
                terminal.innerHTML = terminal.innerHTML.replace(`<div><p class="grey">${event.key}<br></p></div>`, "");
                terminal.innerHTML = terminal.innerHTML.replace('<div><p class="grey"><br></p></div>', "");
                terminal.innerHTML = terminal.innerHTML.replace(event.key, "");
                terminal.innerHTML = terminal.innerHTML.replace(event.key, "");
                terminal.innerHTML = terminal.innerHTML.replace(event.key, "");
                terminal.innerHTML = terminal.innerHTML.replace(event.key, "");
                console.log(terminal.innerHTML.replace(`<div><p class="grey">${event.key}<br></p></div>`, ""));
                console.log("balls");
            }

                // i have no idea why this needs to be stripped out, there is probably a better way but this works i guess
                terminal.innerHTML = terminal.innerHTML.replace('<div><p class="grey"><br></p></div>', "");
                terminal.innerHTML = terminal.innerHTML.replace('<div><p class="grey"><br></p></div>', "");
                terminal.innerHTML = terminal.innerHTML.replace('<div><p class="grey"></p></div>', "");
                
                scrollToBottom();

    });

    // do some funky stuff for backsapce key
    terminal.addEventListener('keydown', function(event) {
    const key = event.key; // const {key} = event; ES6+
    if (key === "Backspace") {
        // delay the blinking for smooth looking typing
        clearTimeout(timeout);
        timeout = window.setTimeout( 
                                                function() {
                                                    terminal.innerHTML += "_";
                                                }, 250);
        intervalManager(0) // stop the blinking of the underscore
        charCount -=1;
        temp = terminal.innerHTML;

        //remove last two chars. then add the underscore back for the blinking animation
        temp = temp.slice(0, temp.length - 1) + "_"; 
        terminal.innerHTML = temp

        scrollToBottom();

        intervalManager(1) // start the blinking of the underscore

    }

    if (key === "ArrowLeft") {
        intervalManager(0) // stop the blinking of the underscore
        arrowCount -= 1;
        var temp = terminal.innerHTML;

        if (temp.indexOf("<u><strong>") > -1){
            temp = temp.replace("<u><strong>", "");
        } 

        if (temp.indexOf("</strong></u>") > -1){
            temp = temp.replace("</strong></u>", "");
        } 

        var newstr = underlineCharAtIndex(temp, temp.length + arrowCount)
        terminal.innerHTML = newstr;

        intervalManager(1) // start the blinking of the underscore

    }
    
    if (key === "ArrowRight") {
        intervalManager(0) // stop the blinking of the underscore
        arrowCount += 1;
        var temp = terminal.innerHTML;

        if (temp.indexOf("<u><strong>") > -1){
            temp = temp.replace("<u><strong>", "");
        } 

        if (temp.indexOf("</strong></u>") > -1){
            temp = temp.replace("</strong></u>", "");
        } 

        var newstr = underlineCharAtIndex(temp, temp.length + arrowCount)
        terminal.innerHTML = newstr;

        if (arrowCount == 0){
            terminal.innerHTML += "_";
        }
        intervalManager(1) // start the blinking of the underscore

    }
    
  });

    // always be strip out the weird part it adds to the top of the div
    var stripping_interval = setInterval(function(){
                terminal.innerHTML = terminal.innerHTML.replace('<div><p class="grey"><br></p></div>', "");
                terminal.innerHTML = terminal.innerHTML.replace('<div><p class="grey"></p></div>', "");
    },0)




    // Require jQuery below
    const scrollingElement = (document.scrollingElement || document.body);

    const scrollToBottom = () => {
    $(scrollingElement).animate({
        scrollTop: document.body.scrollHeight,
    }, 1);
    }


</script>

</body>
</html>
